# 实施计划

- [x] 1. 设置项目结构和依赖





  - 创建项目目录结构
  - 创建 requirements.txt 文件，包含 PyQt6、pytest 和 Hypothesis
  - 创建占位符图像文件（如果不存在）
  - _需求: 1.3, 1.5_

- [x] 2. 实现数据管理模块





  - 创建 `data_manager.py`，实现 `DataManager` 类
  - 实现数据加载、保存、日期检查和重置逻辑
  - 实现等级升级逻辑和图像文件名映射
  - 包含错误处理（文件不存在、JSON 解析错误、权限错误）
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 4.2, 4.3_

- [x] 2.1 编写 DataManager 的基于属性的测试


  - **属性 1: 数据持久化往返一致性**
  - **验证: 需求 2.2, 2.8, 3.7**

- [x] 2.2 编写日期重置的基于属性的测试


  - **属性 2: 日期变化重置任务**
  - **验证: 需求 2.3**

- [x] 2.3 编写升级逻辑的基于属性的测试


  - **属性 3: 升级逻辑一致性**
  - **验证: 需求 2.4, 3.6**

- [x] 2.4 编写等级映射的基于属性的测试


  - **属性 4: 等级到图像映射**
  - **验证: 需求 2.5, 2.6, 2.7**

- [x] 2.5 编写 DataManager 的单元测试


  - 测试默认数据创建
  - 测试错误处理场景
  - _需求: 2.1, 4.2, 4.3_

- [x] 3. 实现主窗口组件





  - 创建 `puffer_widget.py`，实现 `PufferWidget` 类
  - 配置窗口属性（无边框、透明背景、始终置顶）
  - 实现图像加载逻辑，包含占位符处理
  - 实现 `paintEvent` 绘制河豚图像
  - 实现 `contextMenuEvent` 处理右键点击
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 3.1_

- [x] 3.1 编写主窗口的单元测试


  - 测试窗口属性设置（无边框、透明、置顶）
  - 测试图像加载和占位符逻辑
  - _需求: 1.1, 1.2, 1.4, 1.5_

- [x] 4. 实现任务窗口组件





  - 创建 `task_window.py`，实现 `TaskWindow` 类
  - 创建 UI 布局（进度标签、三个复选框）
  - 实现进度更新逻辑
  - 实现复选框状态变化处理
  - 实现窗口关闭时保存数据
  - _需求: 3.2, 3.3, 3.4, 3.5, 3.7_

- [x] 4.1 编写进度显示的基于属性的测试


  - **属性 5: 任务进度显示格式**
  - **验证: 需求 3.2**

- [x] 4.2 编写任务同步的基于属性的测试


  - **属性 6: 任务状态与计数同步**
  - **验证: 需求 3.4, 3.5**

- [x] 4.3 编写任务窗口的单元测试


  - 测试 UI 元素创建
  - 测试复选框交互
  - _需求: 3.3, 3.4, 3.5_

- [x] 5. 实现主程序入口





  - 创建 `main.py`
  - 初始化 QApplication
  - 创建 DataManager 实例
  - 创建并显示 PufferWidget
  - 设置应用程序退出处理
  - _需求: 1.1, 1.3, 2.1, 2.2_

- [x] 6. 集成和连接组件





  - 在 PufferWidget 中集成 TaskWindow
  - 实现任务完成触发图像更新的信号连接
  - 确保数据变化时 UI 正确刷新
  - _需求: 2.4, 3.6_

- [x] 6.1 编写集成测试


  - 测试任务完成触发数据更新和 UI 刷新
  - 测试应用启动流程
  - 测试右键菜单打开任务窗口的完整流程
  - _需求: 2.2, 3.1, 3.6_

- [x] 7. 检查点 - 确保所有测试通过





  - 确保所有测试通过，如有问题请询问用户

- [x] 8. 最终验证和文档





  - 验证所有需求都已实现
  - 测试完整的用户流程（启动 → 完成任务 → 进化 → 重启）
  - 创建简单的 README.md 说明如何运行应用
  - _需求: 所有_


## V2 版本升级任务

- [x] 9. 重构 DataManager 支持多宠物系统





  - 更新 `DataManager` 类以支持新的V2数据结构
  - 实现 `migrate_old_data()` 方法将V1数据迁移到V2格式
  - 实现多宠物相关方法（`get_current_pet_id`, `set_current_pet_id`, `get_unlocked_pets`, `is_pet_unlocked`, `unlock_pet`）
  - 更新现有方法以支持宠物ID参数（`get_level`, `get_tasks_completed`, `increment_task`, `decrement_task`）
  - 更新 `get_image_for_level` 方法以接受宠物ID和等级参数
  - 实现 `get_unlock_condition` 方法返回宠物解锁条件描述
  - 更新 `check_and_reset_daily` 方法以重置所有宠物的每日任务
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.6, 5.7, 5.8, 6.1, 6.2, 6.3, 8.1, 8.2, 8.3, 8.4_

- [x] 9.1 编写数据迁移的基于属性的测试


  - **属性 12: 数据迁移正确性**
  - **验证: 需求 5.8**

- [x] 9.2 编写宠物数据隔离的基于属性的测试

  - **属性 7: 宠物数据隔离**
  - **验证: 需求 5.7, 8.1, 8.2**

- [x] 9.3 编写宠物切换往返的基于属性的测试

  - **属性 8: 宠物切换往返一致性**
  - **验证: 需求 5.6, 5.7, 8.3**

- [x] 9.4 编写解锁条件的基于属性的测试

  - **属性 9: 解锁条件一致性**
  - **验证: 需求 6.1, 6.2, 6.3**

- [x] 9.5 编写访问控制的基于属性的测试

  - **属性 10: 未解锁宠物访问控制**
  - **验证: 需求 6.6**

- [x] 9.6 编写多宠物日期重置的基于属性的测试

  - **属性 11: 多宠物日期重置**
  - **验证: 需求 8.4**

- [x] 9.7 编写宠物图像映射的基于属性的测试

  - **属性 13: 宠物图像映射扩展**
  - **验证: 需求 5.5, 8.5, 8.6, 8.7**

- [x] 9.8 编写 DataManager V2 功能的单元测试


  - 测试数据迁移逻辑
  - 测试多宠物数据管理
  - 测试解锁逻辑
  - _需求: 5.8, 6.1, 6.2, 6.3_

- [x] 10. 重构主窗口组件支持多宠物





  - 将 `puffer_widget.py` 重命名为 `pet_widget.py`
  - 将 `PufferWidget` 类重命名为 `PetWidget`
  - 更新 `load_image()` 方法以根据当前宠物ID加载图像
  - 添加 `switch_pet(pet_id)` 方法处理宠物切换
  - 添加 `show_pet_selector()` 方法显示宠物选择窗口
  - 更新 `contextMenuEvent` 以包含"切换宠物"菜单项
  - 添加 `show_unlock_notification(pet_id)` 方法显示解锁通知
  - _需求: 5.5, 5.6, 6.4, 7.1, 7.2_

- [x] 10.1 更新主窗口的单元测试


  - 更新测试以使用新的类名和方法
  - 测试宠物切换功能
  - 测试右键菜单包含切换选项
  - _需求: 5.6, 7.1_

- [x] 11. 实现宠物选择窗口组件





  - 创建 `pet_selector_window.py`，实现 `PetSelectorWindow` 类
  - 创建 UI 布局显示所有宠物（已解锁和未解锁）
  - 实现 `create_pet_button(pet_id)` 方法创建宠物卡片
  - 显示宠物名称、图标、等级和解锁状态
  - 实现 `on_pet_selected(pet_id)` 方法处理宠物选择
  - 高亮显示当前正在使用的宠物
  - 显示未解锁宠物的锁定图标和解锁条件
  - 阻止选择未解锁的宠物
  - _需求: 6.5, 6.6, 7.3, 7.4, 7.5, 7.6, 7.7_

- [x] 11.1 编写宠物选择窗口的单元测试


  - 测试UI元素创建
  - 测试已解锁宠物显示
  - 测试未解锁宠物显示和访问控制
  - 测试当前宠物高亮
  - _需求: 6.5, 7.3, 7.4, 7.7_

- [x] 12. 更新任务窗口以支持多宠物





  - 更新 `TaskWindow` 以使用当前宠物的数据
  - 确保任务完成只影响当前宠物
  - 更新构造函数以接受 `PetWidget` 而不是 `PufferWidget`
  - _需求: 8.1_

- [x] 12.1 更新任务窗口的单元测试


  - 验证任务只影响当前宠物
  - _需求: 8.1_

- [x] 13. 更新主程序入口





  - 更新 `main.py` 以使用 `PetWidget` 而不是 `PufferWidget`
  - 确保应用启动时正确加载当前宠物
  - _需求: 5.5, 5.6_

- [ ] 14. 添加水母图像资源









    





  - 创建或添加水母的三个等级图像文件
  - 确保图像文件命名符合规范（jelly_stage1_idle.png 等）
  - 如果图像不存在，使用蓝色方块占位符区分河豚
  - _需求: 8.5, 8.6, 8.7_

- [x] 15. 集成和测试多宠物系统





  - 测试完整的宠物切换流程
  - 测试解锁水母的流程
  - 测试数据迁移功能
  - 确保每个宠物的数据独立
  - _需求: 5.6, 5.7, 5.8, 6.1, 8.1, 8.2, 8.3_

- [x] 15.1 编写V2版本的集成测试


  - 测试完整的多宠物工作流程
  - 测试数据迁移后的应用行为
  - 测试解锁通知显示
  - 测试宠物切换后的UI更新
  - _需求: 5.6, 5.7, 5.8, 6.1, 6.4_

- [x] 16. 检查点 - 确保所有V2测试通过





  - 确保所有新测试和旧测试都通过，如有问题请询问用户

- [x] 17. 更新文档





  - 更新 README.md 说明多宠物系统
  - 添加数据迁移说明
  - 添加解锁条件说明
  - 创建用户指南说明如何切换宠物
  - _需求: 所有V2需求_


## V3 版本升级任务（浅海扩容与奇遇系统）

- [x] 18. 重构 DataManager 支持8种生物和层级系统





  - 更新数据结构以支持V3格式（pet_tiers, encounter_settings）
  - 实现 `migrate_v2_to_v3()` 方法将V2数据迁移到V3格式
  - 添加 `get_pet_tier(pet_id)` 方法获取宠物层级
  - 添加 `get_tier_pets(tier)` 方法获取指定层级的所有宠物
  - 更新 `get_image_for_level` 方法支持新的目录结构（assets/[pet_id]/）
  - 为所有8种生物初始化默认数据
  - _需求: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.8_

- [x] 18.1 编写V2到V3数据迁移的基于属性的测试


  - **属性 14: V2到V3数据迁移正确性**
  - **验证: 需求 9.8**

- [x] 18.2 编写宠物层级分类的基于属性的测试


  - **属性 15: 宠物层级分类一致性**
  - **验证: 需求 9.2, 9.3, 9.4**

- [x] 18.3 编写图像路径格式的基于属性的测试


  - **属性 16: 图像路径格式一致性**
  - **验证: 需求 9.5, 9.6**

- [x] 18.4 编写 DataManager V3 功能的单元测试


  - 测试8种生物数据初始化
  - 测试层级查询方法
  - 测试新图像路径生成
  - _需求: 9.1, 9.2, 9.3, 9.4_

- [x] 19. 实现奇遇管理器组件





  - 创建 `encounter_manager.py`，实现 `EncounterManager` 类
  - 实现定时器机制（每5分钟触发一次判定）
  - 实现 `check_encounter_eligibility()` 方法检查奇遇资格
  - 实现 `try_trigger_encounter()` 方法进行概率判定
  - 实现 `get_available_rare_pets()` 方法获取未解锁的Tier 2宠物
  - 实现 `spawn_visitor(pet_id)` 方法生成访客窗口
  - 实现 `on_visitor_captured(pet_id)` 回调处理捕获事件
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7_

- [x] 19.1 编写奇遇资格判定的基于属性的测试


  - **属性 17: 奇遇资格判定正确性**
  - **验证: 需求 10.1, 10.2**

- [x] 19.2 编写奇遇触发概率的基于属性的测试


  - **属性 18: 奇遇触发概率一致性**
  - **验证: 需求 10.4**

- [x] 19.3 编写稀有宠物选择的基于属性的测试


  - **属性 19: 稀有宠物选择有效性**
  - **验证: 需求 10.5**

- [x] 19.4 编写奇遇管理器的单元测试


  - 测试定时器配置
  - 测试资格检查逻辑
  - 测试概率触发机制
  - _需求: 10.1, 10.2, 10.3, 10.4_

- [x] 20. 实现访客窗口组件





  - 创建 `visitor_window.py`，实现 `VisitorWindow` 类
  - 配置窗口属性（无边框、透明、置顶、不响应右键）
  - 实现图像加载逻辑（加载adult_idle.png）
  - 实现横向移动动画（从左到右，15-20秒）
  - 实现 `update_position()` 方法更新窗口位置
  - 实现 `mousePressEvent()` 处理点击捕获
  - 实现 `on_captured()` 处理捕获事件
  - 实现自动销毁逻辑（到达右侧边缘）
  - _需求: 10.8, 11.1, 11.2, 11.3, 11.4, 11.5, 11.7, 12.1, 12.2_

- [x] 20.1 编写访客窗口动画时长的基于属性的测试


  - **属性 20: 访客窗口动画时长一致性**
  - **验证: 需求 11.3**

- [x] 20.2 编写访客窗口的单元测试


  - 测试窗口初始位置
  - 测试移动动画
  - 测试点击捕获
  - 测试自动销毁
  - _需求: 11.1, 11.2, 11.4, 11.5, 11.7_

- [x] 21. 实现捕获系统逻辑





  - 在 DataManager 中添加 `capture_rare_pet(pet_id)` 方法
  - 实现捕获后的数据更新（添加到unlocked_pets，创建pets_data）
  - 实现捕获通知显示功能
  - 更新宠物选择窗口以反映新捕获的宠物
  - _需求: 12.3, 12.4, 12.5, 12.6, 12.7, 12.8_

- [x] 21.1 编写捕获后数据更新的基于属性的测试


  - **属性 21: 捕获后数据更新完整性**
  - **验证: 需求 12.5, 12.6, 12.7**

- [x] 21.2 编写捕获系统的单元测试


  - 测试捕获数据更新
  - 测试通知显示
  - 测试UI状态更新
  - _需求: 12.3, 12.4, 12.8_

- [x] 22. 更新宠物选择窗口支持层级分组





  - 更新 `PetSelectorWindow` 以按层级分组显示宠物
  - 为每个宠物添加层级标签（Tier 1 / Tier 2）
  - 更新未解锁Tier 2宠物的提示文本为"通过奇遇捕获"
  - 实现层级分组的UI布局
  - _需求: 13.6, 13.7, 13.8_

- [x] 22.1 编写宠物选择窗口层级分组的基于属性的测试


  - **属性 23: 宠物选择窗口层级分组正确性**
  - **验证: 需求 13.6, 13.7**

- [x] 22.2 编写未解锁提示的基于属性的测试


  - **属性 24: 未解锁Tier 2宠物提示一致性**
  - **验证: 需求 13.8**

- [x] 22.3 更新宠物选择窗口的单元测试


  - 测试层级分组显示
  - 测试层级标签
  - 测试Tier 2解锁提示
  - _需求: 13.6, 13.7, 13.8_

- [x] 23. 验证Tier 2宠物功能一致性





  - 确保Tier 2宠物使用相同的成长系统
  - 测试Tier 2宠物的任务完成和升级
  - 验证Tier 2宠物的图像加载（baby_idle.png / adult_idle.png）
  - _需求: 13.1, 13.2, 13.3, 13.4, 13.5_

- [x] 23.1 编写Tier 2宠物功能一致性的基于属性的测试


  - **属性 22: Tier 2宠物功能一致性**
  - **验证: 需求 13.1, 13.5**

- [x] 23.2 编写Tier 2宠物的单元测试


  - 测试成长系统
  - 测试图像加载
  - 测试切换显示
  - _需求: 13.2, 13.3, 13.4_

- [x] 24. 重组图像资源到新目录结构





  - 创建 assets/[pet_id]/ 目录结构
  - 为每个宠物创建 baby_idle.png 和 adult_idle.png
  - 如果图像不存在，创建带颜色的占位符（每个宠物不同颜色）
  - 更新图像加载逻辑以使用新路径
  - _需求: 9.6, 9.7_

- [x] 25. 集成奇遇系统到主应用





  - 在 main.py 中初始化 EncounterManager
  - 启动奇遇管理器的定时器
  - 连接捕获事件到数据更新
  - 确保奇遇系统不影响主宠物窗口的正常运行
  - _需求: 10.1, 10.3, 12.1, 12.2_

- [x] 25.1 编写V3版本的集成测试


  - 测试完整的奇遇触发流程
  - 测试捕获流程
  - 测试数据迁移后的应用行为
  - 测试8种生物的切换和培养
  - _需求: 9.8, 10.7, 12.8, 13.1_

- [x] 26. 检查点 - 确保所有V3测试通过





  - 确保所有新测试和旧测试都通过，如有问题请询问用户

- [x] 27. 更新文档




  - 更新 README.md 说明奇遇系统
  - 添加8种生物的介绍
  - 添加层级系统说明
  - 添加捕获机制说明
  - 创建用户指南说明如何触发和捕获稀有生物
  - _需求: 所有V3需求_


## V3.5 版本升级任务（深海盲盒与生态平衡）

- [x] 28. 升级 DataManager 支持库存和奖励系统





  - 更新数据结构以支持V3.5格式（active_pets, reward_system, inventory_limits, tier3配置）
  - 实现 `migrate_v3_to_v35()` 方法将V3数据迁移到V3.5格式
  - 添加 `get_active_pets()` 和 `set_active_pets()` 方法
  - 添加 `can_add_to_inventory()` 和 `can_activate_pet()` 检查方法
  - 添加 `get_cumulative_tasks()` 和 `increment_cumulative_tasks()` 方法
  - 添加 `reset_cumulative_tasks()` 方法
  - 为所有14种生物（Tier 1-3）初始化配置
  - _需求: 14.1, 14.2, 15.1, 16.1, 16.2_

- [x] 28.1 编写库存上限的基于属性的测试


  - **属性 28: 库存上限强制性**
  - **验证: 需求 16.1, 16.3**

- [x] 28.2 编写活跃宠物上限的基于属性的测试

  - **属性 29: 活跃宠物上限强制性**
  - **验证: 需求 16.2, 16.5**

- [x] 28.3 编写库存与活跃集合关系的基于属性的测试

  - **属性 31: 库存与活跃集合关系**
  - **验证: 需求 16.7, 18.7**

- [x] 28.4 编写 DataManager V3.5 功能的单元测试


  - 测试库存和活跃列表管理
  - 测试累计任务计数
  - 测试数据迁移逻辑
  - _需求: 14.1, 14.2, 16.1, 16.2_
- [x] 29. 实现任务奖励管理器



















- [ ] 29. 实现任务奖励管理器

  - 创建 `reward_manager.py`，实现 `RewardManager` 类
  - 实现 `on_task_completed()` 方法处理任务完成
  - 实现 `check_reward_trigger()` 方法检查是否达到12个任务
  - 实现 `trigger_reward()` 方法进行奖励判定（70% Tier 2 / 30% 盲盒）
  - 实现 `unlock_random_tier2()` 方法随机解锁Tier 2宠物
  - 实现 `open_lootbox()` 方法开启深海盲盒
  - 实现 `get_tier3_by_weight()` 方法按权重随机选择Tier 3宠物
  - 实现 `show_reward_notification()` 方法显示奖励通知
  - _需求: 14.3, 14.4, 14.5, 14.6, 14.7, 14.8, 15.2, 15.3_

- [x] 29.1 编写任务奖励触发的基于属性的测试



  - **属性 25: 任务奖励触发一致性**
  - **验证: 需求 14.3**

- [x] 29.2 编写奖励概率分布的基于属性的测试



  - **属性 26: 奖励概率分布正确性**
  - **验证: 需求 14.4**

- [x] 29.3 编写Tier 3抽取权重的基于属性的测试



  - **属性 27: Tier 3抽取权重正确性**
  - **验证: 需求 15.2**

- [x] 29.4 编写奖励管理器的单元测试



  - 测试任务计数和触发逻辑
  - 测试奖励判定概率
  - 测试Tier 2解锁逻辑
  - 测试盲盒开启和权重抽取
  - _需求: 14.3, 14.4, 14.5, 14.6, 15.2_
 

- [x] 30. 实现宠物管理器








  - 创建 `pet_manager.py`，实现 `PetManager` 类
  - 实现 `can_add_to_inventory()` 方法检查库存是否已满
  - 实现 `can_activate_pet()` 方法检查是否可以激活宠物
  - 实现 `add_pet_to_inventory()` 方法添加宠物到库存
  - 实现 `activate_pet()` 方法激活宠物到屏幕
  - 实现 `deactivate_pet()` 方法将宠物从屏幕移除（潜水）
  - 实现 `release_pet()` 方法放生宠物（永久删除）
  - 实现 `load_active_pets()` 方法加载所有活跃宠物窗口
  - 实现 `get_inventory_status()` 方法获取库存状态
  - _需求: 16.3, 16.4, 16.5, 16.6, 16.7, 17.3, 17.4, 17.5, 17.6, 18.3, 18.4, 18.6_

- [x] 30.1 编写放生操作完整性的基于属性的测试


  - **属性 30: 放生操作完整性**
  - **验证: 需求 17.3, 17.4, 17.5**

- [x] 30.2 编写宠物管理器的单元测试


  - 测试库存上限检查
  - 测试活跃宠物上限检查
  - 测试添加、激活、潜水、放生操作
  - 测试多窗口管理
  - _需求: 16.3, 16.4, 16.5, 16.6, 17.3, 17.4, 17.5_

- [x] 31. 更新任务窗口集成奖励系统





  - 修改 `TaskWindow` 的任务完成回调
  - 在任务完成时调用 `RewardManager.on_task_completed()`
  - 处理奖励触发后的通知显示
  - 处理库存已满的情况
  - _需求: 14.2, 14.3, 16.4_

- [x] 31.1 更新任务窗口的单元测试


  - 测试任务完成触发奖励检查
  - 测试奖励通知显示
  - _需求: 14.2, 14.3_

- [x] 32. 更新主窗口支持多宠物显示





  - 修改应用启动逻辑以支持多个 `PetWidget` 实例
  - 实现 `PetManager.load_active_pets()` 在启动时加载所有活跃宠物
  - 为每个活跃宠物创建独立的窗口
  - 更新右键菜单添加"放生"选项
  - 实现放生确认对话框
  - _需求: 16.7, 16.8, 17.1, 17.2, 17.6, 17.7_

- [x] 32.1 更新主窗口的单元测试


  - 测试多窗口创建和管理
  - 测试放生功能
  - 测试放生确认对话框
  - _需求: 17.1, 17.2, 17.6_

- [x] 33. 实现宠物管理窗口





  - 创建 `pet_management_window.py`，实现 `PetManagementWindow` 类
  - 创建UI布局显示库存和活跃宠物列表
  - 实现 `refresh_lists()` 方法刷新列表显示
  - 实现 `on_summon_pet()` 方法处理召唤操作
  - 实现 `on_dive_pet()` 方法处理潜水操作
  - 实现 `on_release_pet()` 方法处理放生操作
  - 显示库存状态（X/20）和活跃状态（X/5）
  - _需求: 18.1, 18.2, 18.3, 18.4, 18.5, 18.6, 18.7, 18.8_

- [x] 33.1 编写宠物管理窗口的单元测试


  - 测试UI元素创建
  - 测试列表刷新
  - 测试召唤、潜水、放生操作
  - 测试上限检查和提示
  - _需求: 18.1, 18.2, 18.3, 18.4, 18.5_

- [x] 34. 实现Tier 3宠物显示和缩放





  - 更新 `PetWidget` 的图像加载逻辑支持Tier 3
  - 实现图像缩放功能（根据tier3_scale_factors）
  - 从 `assets/deep_sea/[pet_id]/idle.png` 加载Tier 3图像
  - 为每种Tier 3宠物应用正确的缩放倍率
  - 处理Tier 3图像缺失情况（深蓝色占位符）
  - _需求: 15.4, 15.5, 15.6, 15.7, 15.8_

- [x] 34.1 编写Tier 3缩放倍率的基于属性的测试


  - **属性 32: Tier 3缩放倍率一致性**
  - **验证: 需求 15.5, 15.6, 15.7**

- [x] 34.2 编写Tier 3显示的单元测试


  - 测试图像路径生成
  - 测试缩放倍率应用
  - 测试占位符显示
  - _需求: 15.4, 15.5, 15.8_

- [x] 35. 添加Tier 3图像资源





  - 确认 `assets/deep_sea/[pet_id]/` 目录结构存在
  - 为6种深海巨兽创建或添加 idle.png 图像
  - 如果图像不存在，创建深蓝色占位符（每种不同深浅）
  - 验证图像文件命名符合规范
  - _需求: 15.4, 15.8_

- [x] 36. 集成V3.5系统到主应用





  - 在 main.py 中初始化 RewardManager 和 PetManager
  - 连接任务完成事件到奖励系统
  - 实现应用启动时加载多个活跃宠物
  - 添加宠物管理窗口的访问入口（托盘图标或主菜单）
  - 确保所有系统协同工作
  - _需求: 14.2, 16.7, 18.1_

- [x] 36.1 编写V3.5版本的集成测试


  - 测试完整的任务奖励流程
  - 测试盲盒开启和Tier 3获得
  - 测试库存管理流程
  - 测试多宠物显示
  - 测试放生和召唤流程
  - _需求: 14.3, 14.4, 15.2, 16.5, 16.6, 17.3, 18.4, 18.6_

- [x] 37. 检查点 - 确保所有V3.5测试通过





  - 确保所有新测试和旧测试都通过，如有问题请询问用户

- [x] 38. 更新文档




  - 更新 README.md 说明任务奖励系统
  - 添加Tier 3深海巨兽介绍
  - 添加库存管理说明
  - 添加放生、召唤、潜水功能说明
  - 创建用户指南说明如何获得深海巨兽
  - _需求: 所有V3.5需求_


## V4 版本升级任务（Kiroween Hackathon - 深海亡灵帝国）

### 黑客松准备阶段

- [x] 39. 创建 Kiro 原生功能展示文件





  - 创建 `.kiro/steering.md` 文件，定义深海代码船长角色
  - 创建 `.kiro/hooks/` 目录
  - 创建 `.kiro/hooks/pre-commit-example.md` 文件，展示 TODO 追踪 hook
  - 编写 Steering 文档内容（戏剧性代码风格要求）
  - 编写 Hook 示例文档（与桌面宠物集成的概念）
  - _需求: 20.1, 20.2, 21.1, 21.2, 21.6, 23.1, 23.2, 23.3_

- [x] 39.1 验证 Kiro 文件结构

  - 确认 `.kiro/steering.md` 存在且内容完整
  - 确认 `.kiro/hooks/` 目录存在
  - 确认 hook 示例文档清晰易懂
  - _需求: 23.1, 23.2, 23.3_

### 万圣节主题系统

- [x] 40. 实现主题管理器





  - 创建 `theme_manager.py`，实现 `ThemeManager` 类
  - 实现 `get_theme_mode()` 和 `set_theme_mode()` 方法
  - 实现 `load_themed_image()` 方法，支持万圣节图像优先加载
  - 实现图像加载回退逻辑（halloween → normal → ghost filter）
  - 实现 `apply_ghost_filter()` 方法（透明度0.6 + 绿/紫光晕）
  - 实现 `get_dark_stylesheet()` 方法返回暗黑主题CSS
  - 实现 `apply_theme_to_widget()` 方法应用主题到窗口
  - _需求: 19.1, 19.2, 19.3, 19.4, 19.5, 19.6, 19.7, 19.8_

- [x] 40.1 编写主题图像加载回退的基于属性的测试


  - **属性 33: 主题图像加载回退正确性**
  - **验证: 需求 19.4, 19.5, 19.6**

- [x] 40.2 编写暗黑主题应用的基于属性的测试


  - **属性 38: 暗黑主题应用完整性**
  - **验证: 需求 19.7, 19.8**


- [x] 40.3 编写主题管理器的单元测试

  - 测试主题模式切换
  - 测试图像加载优先级
  - 测试幽灵滤镜效果
  - 测试暗黑样式表生成
  - _需求: 19.1, 19.2, 19.3, 19.4_

### 捣蛋机制系统

- [x] 41. 实现忽视追踪器



  - 创建 `ignore_tracker.py`，实现 `IgnoreTracker` 类
  - 实现 `start()` 和 `stop()` 方法控制追踪
  - 实现 `on_user_interaction()` 方法重置计时器
  - 实现 `check_ignore_status()` 方法检查是否超过1小时
  - 实现 `trigger_mischief_mode()` 方法触发捣蛋模式
  - 实现 `calm_pet()` 方法安抚单个宠物
  - 实现 `exit_mischief_mode()` 方法退出捣蛋模式
  - 显示"不给糖就捣蛋！"通知
  - _需求: 22.1, 22.2, 22.3, 22.4, 22.8, 22.9, 22.10_

- [x] 41.1 编写忽视检测时间的基于属性的测试


  - **属性 34: 忽视检测时间准确性**
  - **验证: 需求 22.3**

- [x] 41.2 编写捣蛋模式全局一致性的基于属性的测试

  - **属性 35: 捣蛋模式全局一致性**
  - **验证: 需求 22.4, 22.5**


- [x] 41.3 编写安抚操作的基于属性的测试
  - **属性 36: 安抚操作原子性**
  - **验证: 需求 22.8**

- [x] 41.4 编写忽视追踪器的单元测试



  - 测试计时器启动和停止
  - 测试交互重置逻辑
  - 测试1小时阈值检测
  - 测试捣蛋模式触发和退出
  - _需求: 22.1, 22.2, 22.3, 22.9_

- [x] 42. 更新宠物窗口支持愤怒状态





  - 更新 `PetWidget` 添加 `is_angry` 状态
  - 实现 `set_angry()` 方法设置愤怒状态
  - 实现 `set_calm()` 方法恢复正常状态
  - 实现愤怒图像加载（尝试 angry_idle.png）
  - 实现抖动动画（每100ms随机移动±10像素）
  - 实现点击事件处理（愤怒时触发安抚）
  - 集成 ThemeManager 支持幽灵滤镜
  - _需求: 22.4, 22.5, 22.6, 22.7, 22.8, 19.4, 19.5, 19.6_

- [x] 42.1 更新宠物窗口的单元测试


  - 测试愤怒状态切换
  - 测试愤怒图像加载
  - 测试抖动动画
  - 测试点击安抚
  - 测试幽灵滤镜应用
  - _需求: 22.4, 22.5, 22.6, 22.7, 22.8_

### Steering 风格代码重构

- [x] 43. 应用 Steering 风格到现有代码





  - 更新所有模块的文档字符串使用戏剧性语气
  - 更新关键函数的注释（"Warning: Releasing the Kraken..."）
  - 更新错误消息使用深海/诅咒主题
  - 更新日志信息使用海盗/深海语言
  - 确保所有错误处理极其防御性
  - 添加戏剧性的警告信息到关键操作
  - _需求: 20.3, 20.4, 20.5, 20.6, 20.7_

- [x] 43.1 编写 Steering 风格一致性的验证测试


  - **属性 37: Steering 风格一致性**
  - **验证: 需求 20.3, 20.5, 20.6**

- [x] 43.2 代码审查确保风格一致性


  - 审查所有注释和文档字符串
  - 审查所有错误消息
  - 审查所有日志输出
  - 确保符合 Steering 定义的风格
  - _需求: 20.3, 20.4, 20.5, 20.6_

### 万圣节资源准备

- [x] 44. 准备万圣节主题图像资源





  - 为关键宠物创建 halloween_idle.png（可选）
  - 为关键宠物创建 angry_idle.png（可选）
  - 如果图像不存在，确认幽灵滤镜回退正常工作
  - 测试所有宠物在万圣节模式下的显示效果
  - _需求: 19.3, 19.4, 22.5, 22.6_


- [x] 44.1 验证图像加载回退机制

  - 测试有万圣节图像的宠物
  - 测试无万圣节图像的宠物（应用滤镜）
  - 测试有愤怒图像的宠物
  - 测试无愤怒图像的宠物（抖动动画）
  - _需求: 19.4, 22.6_

### 集成和测试

- [x] 45. 集成所有 V4 系统





  - 在 main.py 中初始化 ThemeManager
  - 在 main.py 中初始化 IgnoreTracker
  - 连接用户交互事件到 IgnoreTracker
  - 应用暗黑主题到所有窗口
  - 确保万圣节模式在启动时激活
  - 测试完整的用户流程
  - _需求: 19.1, 19.7, 22.1, 22.2_

- [x] 45.1 编写 V4 版本的集成测试


  - 测试万圣节主题完整流程
  - 测试幽灵滤镜回退机制
  - 测试捣蛋模式触发和安抚
  - 测试暗黑主题应用
  - 测试多宠物在万圣节模式下的显示
  - _需求: 19.3, 19.4, 19.7, 22.3, 22.4, 22.8_

- [x] 46. 检查点 - 确保所有 V4 测试通过





  - 确保所有新测试和旧测试都通过，如有问题请询问用户

### 黑客松文档和演示准备

- [x] 47. 更新项目文档





  - 更新 README.md 添加"黑客松特性"章节
  - 突出展示 Kiro Steering 的使用
  - 突出展示 Agent Hooks 的概念
  - 添加万圣节主题说明
  - 添加捣蛋机制说明
  - 添加完整的功能演示指南
  - 添加项目结构说明（强调 .kiro/ 目录）
  - _需求: 23.4, 23.5, 23.6, 23.7, 23.8_

- [x] 47.1 创建黑客松演示脚本


  - 编写演示流程（5-10分钟）
  - 准备演示数据（预设的宠物和进度）
  - 准备演示场景（展示万圣节主题、捣蛋机制、奖励系统）
  - 准备代码展示（Steering 风格的代码示例）
  - _需求: 23.8_

- [x] 47.2 最终质量检查


  - 验证所有 Kiro 原生功能文件存在
  - 验证代码风格符合 Steering 要求
  - 验证所有功能正常工作
  - 验证文档完整且清晰
  - 准备提交材料
  - _需求: 23.1, 23.2, 23.3, 23.4, 23.5, 23.6_

## V4 黑客松评分对照

### Implementation Score (实现分数)
- ✅ 使用 Kiro Steering 定义代码风格
- ✅ 展示 Agent Hooks 概念和集成可能性
- ✅ 完整的 .kiro/ 目录结构
- ✅ 防御性编程实践
- ✅ 详细的文档字符串和注释

### Creativity Score (创意分数)
- ✅ 万圣节主题皮肤系统
- ✅ 幽灵滤镜回退机制
- ✅ 捣蛋机制（不给糖就捣蛋）
- ✅ 暗黑UI主题
- ✅ 戏剧性的用户体验（诅咒、深海主题）
- ✅ 深海生态系统（V3.5基础）

### Polish Score (完成度分数)
- ✅ 完整的测试覆盖
- ✅ 详细的文档
- ✅ 流畅的用户体验
- ✅ 错误处理完善
- ✅ 演示准备充分


## V5 版本升级任务（深潜与屏保 - Deep Dive & Screensaver）

### 依赖和资源准备

- [x] 48. 安装和配置新依赖





  - 安装 pynput 库用于监听鼠标/键盘活动
  - 更新 requirements.txt 添加 pynput>=1.7.6
  - 验证 pynput 在 Windows 上正常工作
  - 创建 assets/environment/ 目录
  - _需求: 25.1_

- [x] 48.1 准备深潜模式图像资源


  - 创建或添加 assets/environment/seabed.png 海底背景图像
  - 如果图像不存在，创建深蓝色渐变占位符
  - 为关键宠物创建 sleep_idle.png 睡觉图像（可选）
  - _需求: 24.3, 25.4_

### 深潜背景系统

- [x] 49. 实现全屏海底背景窗口





  - 创建 `ocean_background.py`，实现 `OceanBackground` 类
  - 实现 `setup_window()` 方法创建全屏无边框窗口
  - 实现 `set_window_layer()` 方法设置窗口层级（桌面之上，宠物之下）
  - 实现 `load_seabed_image()` 方法加载海底背景
  - 实现 `apply_theme_filter()` 方法应用蓝色/紫色滤镜
  - 实现 `activate()` 和 `deactivate()` 方法控制深潜模式
  - 实现 `paintEvent()` 方法绘制背景和滤镜
  - _需求: 24.1, 24.2, 24.3, 24.4, 24.7, 24.8_

- [x] 49.1 编写深潜背景层级的基于属性的测试


  - **属性 39: 深潜背景层级正确性**
  - **验证: 需求 24.2, 24.8**

- [x] 49.2 编写深潜背景的单元测试


  - 测试全屏窗口创建
  - 测试窗口层级设置
  - 测试背景图像加载
  - 测试滤镜应用
  - _需求: 24.1, 24.2, 24.3, 24.4_

- [x] 50. 实现气泡/鬼火粒子系统





  - 创建 `BubbleParticle` 类实现粒子效果
  - 实现粒子从底部上升到顶部的动画
  - 实现粒子的随机生成（位置、大小、速度）
  - 实现普通气泡效果（蓝白色半透明）
  - 实现鬼火效果（绿色/紫色发光）
  - 实现粒子的左右摇摆效果
  - 在 OceanBackground 中集成粒子系统
  - _需求: 24.5, 24.6, 26.2, 26.3_

- [x] 50.1 编写粒子系统的单元测试


  - 测试粒子生成和初始化
  - 测试粒子移动和边界检测
  - 测试普通气泡和鬼火模式切换
  - 测试粒子绘制
  - _需求: 24.5, 24.6, 26.2_

### 空闲监视和屏保系统

- [x] 51. 实现空闲监视器





  - 创建 `idle_watcher.py`，实现 `IdleWatcher` 类
  - 实现 `setup_input_hooks()` 方法使用 pynput 监听鼠标/键盘
  - 实现 `on_user_activity()` 方法重置空闲计时器
  - 实现 `check_idle_status()` 方法检查是否超过5分钟
  - 实现 `start()` 和 `stop()` 方法控制监视
  - 处理 pynput 的线程安全问题
  - _需求: 25.1, 25.2, 25.6, 25.7_

- [x] 51.1 编写空闲检测时间的基于属性的测试


  - **属性 40: 空闲检测时间准确性**
  - **验证: 需求 25.2**

- [x] 51.2 编写唤醒响应的基于属性的测试

  - **属性 43: 唤醒响应即时性**
  - **验证: 需求 25.6, 25.7**

- [x] 51.3 编写空闲监视器的单元测试


  - 测试监视器启动和停止
  - 测试活动检测和计时器重置
  - 测试5分钟阈值检测
  - 测试鼠标/键盘事件处理
  - _需求: 25.1, 25.2, 25.6, 25.7_

- [x] 52. 实现屏保模式逻辑





  - 实现 `activate_screensaver()` 方法激活屏保
  - 实现 `deactivate_screensaver()` 方法关闭屏保
  - 实现 `gather_pets_to_center()` 方法将宠物聚拢到中央
  - 实现 `restore_pet_positions()` 方法恢复宠物位置
  - 实现宠物移动动画（使用 QPropertyAnimation）
  - 保存和恢复宠物原始位置
  - _需求: 25.3, 25.4, 25.5, 25.8_

- [x] 52.1 编写宠物位置恢复的基于属性的测试


  - **属性 41: 宠物位置恢复完整性**
  - **验证: 需求 25.8**

- [x] 52.2 编写屏保模式的单元测试


  - 测试屏保激活和关闭
  - 测试宠物聚拢动画
  - 测试位置保存和恢复
  - 测试睡觉图像切换
  - _需求: 25.3, 25.4, 25.5, 25.8_

### 万圣节主题联动

- [x] 53. 实现深潜模式的万圣节联动





  - 更新 OceanBackground 支持万圣节主题
  - 实现万圣节模式下的紫色/黑色背景滤镜
  - 实现气泡到鬼火的粒子切换
  - 实现主题切换时的实时更新
  - 更新宠物睡觉图像加载逻辑（支持 halloween_sleep.png）
  - _需求: 26.1, 26.2, 26.3, 26.4, 26.5, 26.6, 26.7_

- [x] 53.1 编写主题联动一致性的基于属性的测试


  - **属性 42: 主题联动一致性**
  - **验证: 需求 26.1, 26.2, 26.3, 26.4**

- [x] 53.2 编写万圣节联动的单元测试


  - 测试万圣节滤镜颜色
  - 测试鬼火粒子效果
  - 测试主题切换时的更新
  - 测试万圣节睡觉图像加载
  - _需求: 26.1, 26.2, 26.3, 26.5_

### 菜单和控制集成

- [x] 54. 更新菜单添加深潜模式控制





  - 在托盘图标右键菜单添加"深潜模式"开关
  - 实现菜单状态与深潜模式同步
  - 实现手动开启/关闭深潜模式
  - 区分手动激活和自动（屏保）激活
  - 更新数据文件记录深潜模式状态
  - _需求: 27.1, 27.2, 27.3, 27.4, 27.5, 27.6, 27.7, 27.8_

- [x] 54.1 编写手动与自动模式区分的基于属性的测试


  - **属性 44: 手动与自动模式区分**
  - **验证: 需求 27.5, 27.6**

- [x] 54.2 编写菜单控制的单元测试


  - 测试菜单选项显示
  - 测试开关状态切换
  - 测试手动激活不聚拢宠物
  - 测试状态保存
  - _需求: 27.1, 27.2, 27.3, 27.4_

### 宠物窗口更新

- [x] 55. 更新宠物窗口支持睡觉状态





  - 添加 `is_sleeping` 状态到 PetWidget
  - 实现 `set_sleeping()` 方法切换睡觉状态
  - 实现睡觉图像加载（sleep_idle.png）
  - 实现睡觉时的轻微上下浮动动画
  - 确保宠物窗口始终在深潜背景之上
  - _需求: 25.4, 25.5, 24.8_

- [x] 55.1 更新宠物窗口的单元测试


  - 测试睡觉状态切换
  - 测试睡觉图像加载
  - 测试浮动动画
  - 测试窗口层级
  - _需求: 25.4, 25.5, 24.8_

### 集成和测试

- [x] 56. 集成所有 V5 系统





  - 在 main.py 中初始化 OceanBackground
  - 在 main.py 中初始化 IdleWatcher
  - 连接空闲检测到屏保激活
  - 连接用户活动到屏保关闭
  - 确保深潜模式与现有功能兼容
  - 测试完整的用户流程
  - _需求: 24.1, 25.1, 25.2, 27.1_

- [x] 56.1 编写 V5 版本的集成测试


  - 测试深潜模式完整流程
  - 测试屏保自动激活和唤醒
  - 测试宠物聚拢和恢复
  - 测试万圣节主题联动
  - 测试手动和自动模式区分
  - _需求: 24.1, 24.7, 25.2, 25.8, 26.1, 27.5_

- [x] 57. 检查点 - 确保所有 V5 测试通过





  - 确保所有新测试和旧测试都通过，如有问题请询问用户

### 文档更新

- [x] 58. 更新项目文档





  - 更新 README.md 添加深潜模式说明
  - 添加屏保功能说明
  - 添加万圣节联动说明
  - 添加快捷键和菜单操作指南
  - 更新依赖项说明（pynput）
  - _需求: 所有V5需求_


## V5.5 版本升级任务（动态昼夜循环 - Dynamic Day/Night Cycle）

### 时间管理系统

- [-] 59. 实现时间管理器



  - 创建 `time_manager.py`，实现 `TimeManager` 类
  - 实现 `get_current_period()` 方法获取当前时段（day/night）
  - 实现 `is_daytime()` 方法判断是否为白天（06:00-18:00）
  - 实现 `check_time_and_update()` 方法检查时间并触发模式切换
  - 实现 `start()` 和 `stop()` 方法控制定时器（每分钟检查）
  - 实现 `switch_to_day()` 和 `switch_to_night()` 方法切换模式
  - 实现 `set_auto_sync()` 方法设置自动同步开关
  - 实现 `manual_toggle()` 方法手动切换昼夜
  - _需求: 28.1, 28.2, 28.3, 28.4, 28.5, 28.6, 28.7_

- [x] 59.1 编写时间判定准确性的基于属性的测试


  - **属性 45: 时间判定准确性**
  - **验证: 需求 28.2, 28.3**

- [x] 59.2 编写模式映射一致性的基于属性的测试


  - **属性 46: 模式映射一致性**
  - **验证: 需求 28.6, 28.7**



- [x] 59.3 编写自动同步控制的基于属性的测试
  - **属性 47: 自动同步控制正确性**
  - **验证: 需求 30.3, 30.4**



- [x] 59.4 编写时间管理器的单元测试






  - 测试时间判定逻辑（边界值：05:59, 06:00, 17:59, 18:00）
  - 测试定时器启动和停止
  - 测试模式切换触发
  - 测试自动同步开关
  - _需求: 28.1, 28.2, 28.3, 28.4, 28.5_

### 主题管理器重构

- [x] 60. 重构主题管理器支持昼夜映射





  - 更新 `ThemeManager` 添加昼夜模式映射逻辑
  - 实现 `set_day_mode()` 方法（设置 theme_mode="normal"）
  - 实现 `set_night_mode()` 方法（设置 theme_mode="halloween"）
  - 确保黑夜模式复用所有万圣节视觉效果
  - 实现模式切换时的平滑过渡
  - 发出模式切换信号通知其他组件
  - _需求: 28.6, 28.7, 28.8, 29.1, 29.5_

- [x] 60.1 编写视觉效果与模式同步的基于属性的测试


  - **属性 48: 视觉效果与模式同步**
  - **验证: 需求 28.8, 29.1-29.8**

- [x] 60.2 更新主题管理器的单元测试


  - 测试昼夜模式映射
  - 测试模式切换信号
  - 测试视觉效果更新
  - _需求: 28.6, 28.7, 28.8_

### 深潜背景昼夜支持

- [x] 61. 更新深潜背景支持昼夜切换





  - 更新 `OceanBackground` 支持白天/黑夜背景图像
  - 实现 `load_background_for_mode()` 方法加载对应背景
  - 实现 `apply_night_filter()` 方法（当黑夜背景不存在时）
  - 更新滤镜颜色切换（白天浅蓝色，黑夜深紫色）
  - 更新粒子类型切换（白天气泡，黑夜鬼火）
  - 监听模式切换信号并更新显示
  - _需求: 29.2, 29.3, 29.4, 29.6, 29.7, 29.8_

- [x] 61.1 编写背景回退正确性的基于属性的测试


  - **属性 50: 背景回退正确性**
  - **验证: 需求 29.7**

- [x] 61.2 更新深潜背景的单元测试


  - 测试白天背景加载
  - 测试黑夜背景加载
  - 测试黑夜背景回退（应用滤镜）
  - 测试滤镜颜色切换
  - 测试粒子类型切换
  - _需求: 29.2, 29.3, 29.4, 29.6, 29.7, 29.8_

### 设置菜单实现

- [x] 62. 实现设置菜单





  - 在右键菜单中添加"设置 (Settings)"子菜单
  - 添加"跟随系统时间 (Auto Day/Night)"复选框选项
  - 添加"切换昼夜 (Toggle Day/Night)"操作选项
  - 实现复选框状态与 auto_time_sync 同步
  - 实现"切换昼夜"选项的条件可用性
  - 连接菜单操作到 TimeManager 方法
  - _需求: 30.1, 30.2, 30.5, 30.6, 30.7, 30.8_

- [x] 62.1 编写设置菜单的单元测试


  - 测试菜单结构
  - 测试复选框默认状态
  - 测试"切换昼夜"条件可用性
  - 测试菜单操作触发
  - _需求: 30.1, 30.2, 30.5, 30.6, 30.7_

### 数据持久化

- [x] 63. 更新数据管理器支持昼夜设置





  - 添加 `day_night_settings` 字段到数据结构
  - 实现 `get_auto_time_sync()` 和 `set_auto_time_sync()` 方法
  - 实现 `get_current_day_night_mode()` 和 `set_current_day_night_mode()` 方法
  - 实现数据迁移逻辑（V5 → V5.5）
  - 确保设置更改立即保存
  - 实现启动时加载设置逻辑
  - _需求: 31.1, 31.2, 31.3, 31.4, 31.5, 31.6, 31.7, 31.8_

- [x] 63.1 编写设置持久化的基于属性的测试


  - **属性 49: 设置持久化完整性**
  - **验证: 需求 31.4, 31.5, 31.6, 31.7**

- [x] 63.2 更新数据管理器的单元测试


  - 测试昼夜设置读写
  - 测试数据迁移
  - 测试默认值处理
  - 测试启动时加载逻辑
  - _需求: 31.1, 31.2, 31.3, 31.8_

### 资源准备

- [x] 64. 准备昼夜背景图像资源





  - 创建或重命名 assets/environment/seabed_day.png
  - 创建 assets/environment/seabed_night.png（可选）
  - 如果黑夜背景不存在，确认回退逻辑正常工作
  - 测试白天和黑夜背景的视觉效果
  - _需求: 29.2, 29.6, 29.7_

### 集成和测试

- [x] 65. 集成所有 V5.5 系统





  - 在 main.py 中初始化 TimeManager
  - 连接 TimeManager 到 ThemeManager
  - 连接模式切换信号到所有相关组件
  - 确保启动时正确初始化昼夜模式
  - 测试完整的昼夜循环流程
  - _需求: 28.1, 28.4, 28.5, 28.8_

- [x] 65.1 编写 V5.5 版本的集成测试


  - 测试自动时间同步完整流程
  - 测试手动昼夜切换
  - 测试模式切换时的视觉更新
  - 测试设置持久化
  - 测试与深潜模式的联动
  - _需求: 28.5, 28.8, 30.3, 30.4, 31.4_

- [x] 66. 检查点 - 确保所有 V5.5 测试通过





  - 确保所有新测试和旧测试都通过，如有问题请询问用户

### 文档更新

- [x] 67. 更新项目文档





  - 更新 README.md 添加昼夜循环说明
  - 添加时间同步功能说明
  - 添加设置菜单使用指南
  - 说明昼夜模式与万圣节主题的关系
  - 更新视觉效果对比说明
  - _需求: 所有V5.5需求_

## V5.5 版本亮点总结

### 设计优雅性
- ✅ 复用万圣节主题作为黑夜模式，代码复用最大化
- ✅ 自然的昼夜循环，与现实时间同步
- ✅ 智能回退机制，无需额外资源也能工作

### 用户体验
- ✅ 默认自动跟随系统时间，零配置
- ✅ 可选手动控制，满足个性化需求
- ✅ 平滑的模式切换，无突兀感

### 技术实现
- ✅ 每分钟检查一次，低资源消耗
- ✅ 设置持久化，重启后保持偏好
- ✅ 与深潜模式完美联动


## 工具任务：智能切片与万圣节生成工具

- [x] 68. 创建素材处理工具








  - 创建 `tools/` 目录
  - 创建 `tools/process_assets.py` 文件
  - 实现 `AssetProcessor` 类
  - 实现 `remove_background()` 方法（支持 rembg 和回退）
  - 实现 `halloweenify()` 方法（灰度化 + 着色 + 透明化）
  - 实现 `process_sheet()` 方法（切片 + 保存）
  - 添加硬编码的处理配置
  - _需求: 32.1-32.8, 33.1-33.8_

- [x] 68.1 编写素材处理工具的单元测试


  - 测试去底功能
  - 测试万圣节化功能
  - 测试切片功能
  - 测试行忽略逻辑
  - _需求: 32.5, 32.6, 33.1, 33.2_
