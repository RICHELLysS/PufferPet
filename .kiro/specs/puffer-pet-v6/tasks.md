# V6 稳定版实施计划

## 重构任务

- [x] 1. 创建 logic_growth.py - 成长状态机




  - [x] 1.1 实现 GrowthManager 类





    - 数据加载/保存
    - get_state(), get_progress() 方法
    - complete_task() 状态转换逻辑
    - reset_cycle() 重置功能
    - _需求: 1.5, 1.8, 2.1-2.5_
  - [x] 1.2 编写属性测试：状态转换正确性






    - **属性 1: 状态转换正确性**
    - **验证: 需求 1.5, 1.8**
  - [x] 1.3 编写属性测试：任务进度与状态同步







    - **属性 2: 任务进度与状态同步**



    - **验证: 需求 2.3, 2.4**

- [x] 2. 创建 pet_core.py - 宠物显示核心





  - [x] 2.1 实现 PetWidget 类


    - 窗口属性（无边框、透明、置顶）
    - 智能图像加载（gif → 序列帧 → png → 占位符）
    - 休眠滤镜（灰度+60%透明度）

    - 状态驱动的显示更新
    - _需求: 1.1-1.4, 1.6-1.9, 3.1-3.5_
  - [x] 2.2 编写属性测试：图像加载回退







    - **属性 3: 图像加载回退**
    - **验证: 需求 3.1-3.4**



  - [x] 2.3 实现拖拽和交互逻辑

    - 休眠状态禁止拖拽
    - 幼年/成年状态允许拖拽
    - 右键菜单显示任务窗口

    - _需求: 1.3, 1.7, 1.4_

- [x] 3. 创建简化版 main.py


  - [x] 3.1 实现程序入口

    - QApplication 初始化




    - GrowthManager 初始化
    - PetWidget 创建和显示
    - _需求: 所有_
  - [x] 3.2 实现系统托盘菜单

    - 任务窗口入口
    - 重置周期选项


    - 退出选项
    - _需求: 2.5_
  - [x] 3.3 集成昼夜模式（保留 time_manager.py）




    - 自动时间同步
    - 主题切换
    - _需求: 4.1-4.3_

- [-] 4. 清理旧代码






  - [ ] 4.1 移除或简化以下模块


    - encounter_manager.py（移除奇遇概率逻辑）
    - reward_manager.py（移除盲盒逻辑）
    - pet_manager.py（简化为单宠物）
    - visitor_window.py（移除）
    - _清理任务_

- [ ] 5. 检查点
  - 确保所有测试通过，如有问题请询问用户

- [x] 6. 最终验证





  - 测试完整流程：启动 → 完成任务 → 进化
  - 验证图像回退机制
  - 验证昼夜模式
